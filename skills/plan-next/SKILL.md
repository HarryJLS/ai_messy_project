---

name: plan-next
description: ä½¿ç”¨ TDD å¾ªç¯æ‰§è¡Œä¸‹ä¸€ä¸ªå¾…å¤„ç†ä»»åŠ¡ã€‚å½“ç”¨æˆ·è¯´ "/plan-next"ã€"æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡"ã€"ç»§ç»­ä»»åŠ¡"ã€"å¼€å§‹å¼€å‘" æ—¶è§¦å‘ã€‚å¿…é¡»å…ˆè¿è¡Œ /plan-init åˆ›å»º features.jsonã€‚æ‰§è¡Œ READ â†’ EXPLORE â†’ PLAN â†’ RED â†’ IMPLEMENT â†’ GREEN â†’ COMMIT ä¸ƒé˜¶æ®µæµç¨‹ã€‚
---

# Plan Next

ä½¿ç”¨ Feature-Dev å·¥ä½œæµå’Œ TDD å¾ªç¯æ‰§è¡Œä¸‹ä¸€ä¸ªå¾…å¤„ç†ä»»åŠ¡ã€‚

## å…³é”®è§„åˆ™

- **ä¸€æ¬¡ä¸€ä¸ªä»»åŠ¡**ï¼Œä»…åœ¨éªŒè¯åè®¾ç½® `passes: true`
- **TDD å¼ºåˆ¶**ï¼šå¿…é¡»å…ˆçœ‹åˆ° RED å†çœ‹ GREEN
- **æ—¥å¿—ç”¨äºæ¢å¤**ï¼šæ¯æ¡æ—¥å¿—å¿…é¡»èƒ½åœ¨æ–°ä¼šè¯ä¸­æ¢å¤ä¸Šä¸‹æ–‡
- **èµ„æ·±å¼€å‘è§†è§’**ï¼šè€ƒè™‘ä»£ç è´¨é‡ã€è¾¹ç•Œæƒ…å†µã€é”™è¯¯å¤„ç†ã€å¯ç»´æŠ¤æ€§

## æ—¥å¿—æ ¼å¼

æ¯æ¡æ—¥å¿—å†™å…¥ `logs/task-{id}.log`ï¼Œå¿…é¡»å›ç­”ï¼š**"å¦‚æœæˆ‘åœ¨æ–°ä¼šè¯ä¸­åªè¯»è¿™æ¡æ—¥å¿—ï¼Œèƒ½å¦ç»§ç»­ï¼Ÿ"**

```
[æ—¶é—´æˆ³] [é˜¶æ®µ] Task N: ä¸€å¥è¯æ¦‚è¿°
â”œâ”€ çŠ¶æ€: exploring|planning|red|green|blocked|done
â”œâ”€ å†³ç­–: å…³é”®å†³ç­–ï¼ˆä¸ºä»€ä¹ˆè¿™æ ·åšï¼‰
â”œâ”€ æ–‡ä»¶: file1.ts, file2.tsï¼ˆå·²æ”¹/å°†æ”¹ï¼‰
â”œâ”€ é—®é¢˜: é‡åˆ°çš„é—®é¢˜ â†’ è§£å†³æ–¹æ¡ˆï¼ˆæˆ– noneï¼‰
â””â”€ ä¸‹ä¸€æ­¥: å…·ä½“ä¸‹ä¸€æ­¥æ“ä½œ
---
```

## é˜¶æ®µ 1: READ

1. è¯»å– `features.json`ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª `passes: false`
2. å¦‚æœæ²¡æœ‰ï¼š"æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆ ğŸ‰" â†’ åœæ­¢
3. å®£å¸ƒï¼š"å¼€å§‹ä»»åŠ¡ [ID]: [æè¿°]"

## é˜¶æ®µ 2: EXPLOREï¼ˆæ¡ä»¶æ‰§è¡Œï¼‰

**ä»…å½“ä»»åŠ¡ä¿®æ”¹ç°æœ‰ä»£ç æ—¶æ‰§è¡Œ**ï¼Œæ–°åŠŸèƒ½è·³è¿‡ã€‚

- ä¿®æ”¹ç°æœ‰åŠŸèƒ½ â†’ å¿…é¡» Explore
- å…¨æ–°åŠŸèƒ½ â†’ è·³è¿‡ï¼Œç›´æ¥é˜¶æ®µ 3

**æ‰§è¡Œæ—¶**ï¼šç”¨æ–‡ä»¶æœç´¢å’Œé˜…è¯»å·¥å…·åˆ†æç°æœ‰ä»£ç 

**æ—¥å¿—**:
```
[æ—¶é—´æˆ³] [Explore] Task N: åˆ†æ XXX æ¨¡å—
â”œâ”€ çŠ¶æ€: exploring â†’ planning
â”œâ”€ å†³ç­–: å‘ç° XXX æ¨¡å¼ï¼Œè®¡åˆ’å¤ç”¨/æ‰©å±•
â”œâ”€ æ–‡ä»¶: existing1.ts, existing2.tsï¼ˆå°†ä¿®æ”¹ï¼‰
â”œâ”€ é—®é¢˜: none
â””â”€ ä¸‹ä¸€æ­¥: åˆ¶å®šå®ç°è®¡åˆ’
---
```

## é˜¶æ®µ 3: PLAN

1. æŸ¥çœ‹ä»»åŠ¡çš„ `steps`, `acceptance`, `test`, `boundary` å­—æ®µ
2. å¦‚æœæ¨¡ç³Š â†’ å…ˆæ›´æ–° features.json
3. **å½±å“èŒƒå›´ç¡®è®¤**ï¼š
   - åˆ—å‡ºå°†è¦ä¿®æ”¹çš„æ–‡ä»¶/ç±»/æ–¹æ³•
   - åˆ—å‡ºç›¸ä¼¼ä½†**ä¸åº”ä¿®æ”¹**çš„æ–‡ä»¶/ç±»/æ–¹æ³•
   - å¦‚æœæœ‰ `boundary` å­—æ®µï¼Œç¡®è®¤ç†è§£è¾¹ç•Œ
4. **Service æ¶æ„é¢„è¯„ä¼°**ï¼š
   - è¯„ä¼°æ–°å¢åŠŸèƒ½çš„å¤æ‚åº¦å’ŒèŒè´£å½’å±
   - æ£€æŸ¥æ˜¯å¦æœ‰åˆé€‚çš„ç°æœ‰ service å¯ä»¥æ‰©å±•
   - é¢„åˆ¤æ˜¯å¦éœ€è¦æ–°å»º service æˆ–æ–¹æ³•æŠ½å–
   - åˆ—å‡ºå€™é€‰çš„ service æ–¹æ¡ˆï¼š`ç°æœ‰ServiceA.newMethod()` æˆ– `æ–°å»ºServiceB`
5. å†™æ—¥å¿—

**æ—¥å¿—**:
```
[æ—¶é—´æˆ³] [Plan] Task N: è®¡åˆ’ XXX åŠŸèƒ½
â”œâ”€ çŠ¶æ€: planning â†’ red
â”œâ”€ å†³ç­–: æŠ€æœ¯é€‰å‹/æ¶æ„å†³ç­–è¦ç‚¹
â”œâ”€ æ–‡ä»¶: new1.ts, new2.tsï¼ˆå°†åˆ›å»ºï¼‰| existing.tsï¼ˆå°†ä¿®æ”¹ï¼‰
â”œâ”€ Service æ–¹æ¡ˆ: æ‰©å±• XxxService | æ–°å»º YyyService | ä¿ç•™åœ¨ Controllerï¼ˆåŸå› ï¼‰
â”œâ”€ é—®é¢˜: é¢„è§çš„æŒ‘æˆ˜ â†’ åº”å¯¹æ–¹æ¡ˆ
â””â”€ ä¸‹ä¸€æ­¥: ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®è®¤ RED çŠ¶æ€
---
```

## é˜¶æ®µ 4: TDD RED ğŸ”´

âš ï¸ **å¿…é¡»å…ˆçœ‹åˆ°æµ‹è¯•å¤±è´¥ï¼Œå†å†™ä¸šåŠ¡ä»£ç **

1. æ ¹æ®ä»»åŠ¡ `test` å­—æ®µé€‰æ‹©éªŒè¯æ–¹å¼ï¼š
   - `unit/integration/e2e` â†’ **è°ƒç”¨ `/unit-test` skill**
   - `manual` â†’ å†™éªŒè¯æ£€æŸ¥æ¸…å•

2. **è°ƒç”¨ `/unit-test` skill**ï¼ˆé manual ç±»å‹æ—¶ï¼‰ï¼š
   - `/unit-test` ä¼šè‡ªåŠ¨æ£€æµ‹é¡¹ç›®è¯­è¨€ï¼ˆGo/Javaï¼‰
   - æ ¹æ®é¡¹ç›®ç°æœ‰æµ‹è¯•é£æ ¼ç”Ÿæˆæµ‹è¯•ä»£ç 
   - å®Œæˆåè‡ªåŠ¨è¿”å›ï¼Œç»§ç»­åç»­é˜¶æ®µ

3. è¿è¡Œæµ‹è¯•ï¼Œ**ç¡®è®¤å¤±è´¥**

**æ—¥å¿—**:
```
[æ—¶é—´æˆ³] [Red] Task N: æµ‹è¯•å‡†å¤‡å®Œæˆ
â”œâ”€ çŠ¶æ€: red â†’ implementing
â”œâ”€ å†³ç­–: é€‰æ‹© XXX æµ‹è¯•æ–¹å¼ï¼Œå› ä¸º YYY
â”œâ”€ æ–‡ä»¶: test.spec.tsï¼ˆå·²åˆ›å»ºï¼‰
â”œâ”€ æµ‹è¯•æ¡†æ¶: [Go: Mockey+Testify | Java: Spock/JUnit]ï¼ˆç”± /unit-test æ£€æµ‹ï¼‰
â”œâ”€ é—®é¢˜: none
â””â”€ ä¸‹ä¸€æ­¥: å®ç°åŠŸèƒ½ä»£ç ï¼Œè®©æµ‹è¯•é€šè¿‡
---
```

## é˜¶æ®µ 5: IMPLEMENT

- å†™æœ€å°ä»£ç è®©æµ‹è¯•é€šè¿‡
- åªåšå½“å‰ä»»åŠ¡ï¼Œä¸åšé¢å¤–"æ”¹è¿›"
- **ä»£ç è¡Œé•¿åº¦**ï¼šå•è¡Œä¸è¶…è¿‡ 120 å­—ç¬¦ï¼Œè¶…è¿‡æ—¶æ¢è¡Œï¼š
  - åœ¨è¿ç®—ç¬¦ã€é€—å·ã€ç‚¹å·åæ¢è¡Œ
  - ä¸‹ä¸€è¡Œé€‚å½“ç¼©è¿›ï¼ˆ4 ç©ºæ ¼æˆ– 1 tabï¼‰
  - é•¿å­—ç¬¦ä¸²ç”¨ `+` åˆ†è¡Œè¿æ¥
- **Service æ–¹æ³•æŠ½å–ç­–ç•¥**ï¼š
  - **åˆ¤æ–­æŠ½å–æ—¶æœº**ï¼šæ–°å¢æ–¹æ³•æ—¶è¯„ä¼°æ˜¯å¦éœ€è¦æŠ½å–åˆ° service
  - **æŠ½å–åŸåˆ™**ï¼š
    - åŒ…å«å¤æ‚ä¸šåŠ¡é€»è¾‘ â†’ æŠ½å–åˆ°å¯¹åº”ä¸šåŠ¡ service
    - çº¯æŠ€æœ¯æ“ä½œï¼ˆæ•°æ®åº“ã€ç¼“å­˜ã€æ–‡ä»¶ï¼‰â†’ æŠ½å–åˆ°æŠ€æœ¯ service
    - è·¨æ¨¡å—é€šç”¨é€»è¾‘ â†’ æŠ½å–åˆ° common/utils service
    - ç®€å•çš„å±æ€§èµ‹å€¼ã€æ ¼å¼è½¬æ¢ â†’ ä¿ç•™åœ¨å½“å‰ç±»
  - **å‘½åè§„èŒƒ**ï¼š
    - ä¸šåŠ¡æ–¹æ³•ï¼š`calculateUserScore()`, `processOrderPayment()`
    - æŠ€æœ¯æ–¹æ³•ï¼š`saveToCache()`, `sendNotification()`
    - å·¥å…·æ–¹æ³•ï¼š`formatDate()`, `validateParams()`
- **ç–‘ä¼¼ç¡®è®¤**ï¼ˆé˜²æ­¢è¯¯æ”¹ï¼‰ï¼š
  - å¦‚æœå‘ç°ç›¸ä¼¼ä½†ä¸ç¡®å®šæ˜¯å¦è¦æ”¹çš„åœ°æ–¹ï¼Œ**åœä¸‹æ¥åˆ—å‡º**
  - æ ¼å¼ï¼š`âš ï¸ ç–‘ä¼¼éœ€è¦ä¿®æ”¹ï¼š[ä½ç½®] - [åŸå› ] - è¯·ç¡®è®¤æ˜¯å¦å¤„ç†`
  - â›” **ç­‰å¾…ç”¨æˆ·ç¡®è®¤** åå†ç»§ç»­

**æ¢è¡Œç¤ºä¾‹**ï¼š
```java
// æ–¹æ³•è°ƒç”¨æ¢è¡Œ
String result = someService.processData(param1, param2,
    param3, param4);

// æ¡ä»¶è¡¨è¾¾å¼æ¢è¡Œ
boolean isValid = StringUtils.isNotEmpty(name) && value > 0
    && status == Status.ACTIVE;

// é•¿å­—ç¬¦ä¸²æ¢è¡Œ
String message = "This is a very long error message that exceeds "
    + "the maximum line length limit";
```

```go
// Go æ–¹æ³•è°ƒç”¨æ¢è¡Œ
result, err := someService.ProcessData(ctx, param1, param2,
    param3, param4)

// Go é•¿å­—ç¬¦ä¸²
message := "This is a very long error message that exceeds " +
    "the maximum line length limit"
```

### 5.1: Service æ–¹æ³•æŠ½å–å†³ç­–æµç¨‹

æ¯å½“å®ç°æ–°æ–¹æ³•æ—¶ï¼ŒæŒ‰ä»¥ä¸‹æµç¨‹è¯„ä¼°ï¼š

```
æ–°å¢æ–¹æ³• â†’ è¯„ä¼°å¤æ‚åº¦ â†’ å†³ç­–æŠ½å–
    â†“
1. æ–¹æ³•åŠŸèƒ½åˆ†æï¼š
   â”œâ”€ çº¯ä¸šåŠ¡é€»è¾‘ï¼Ÿ â†’ è€ƒè™‘æŠ½å–åˆ° BusinessService
   â”œâ”€ æ•°æ®æ“ä½œï¼Ÿ â†’ è€ƒè™‘æŠ½å–åˆ° DataService/Repository
   â”œâ”€ å¤–éƒ¨è°ƒç”¨ï¼Ÿ â†’ è€ƒè™‘æŠ½å–åˆ° IntegrationService
   â”œâ”€ å·¥å…·æ€§è´¨ï¼Ÿ â†’ è€ƒè™‘æŠ½å–åˆ° UtilsService
   â””â”€ ç®€å•è½¬æ¢ï¼Ÿ â†’ ä¿ç•™åœ¨å½“å‰ç±»

2. å¤æ‚åº¦åˆ¤æ–­ï¼š
   â”œâ”€ è¶…è¿‡ 10 è¡Œ â†’ å¼ºçƒˆå»ºè®®æŠ½å–
   â”œâ”€ åŒ…å«åˆ†æ”¯åˆ¤æ–­ â†’ å»ºè®®æŠ½å–
   â”œâ”€ æœ‰é”™è¯¯å¤„ç† â†’ å»ºè®®æŠ½å–
   â””â”€ ç®€å•èµ‹å€¼ â†’ ä¸æŠ½å–

3. å¯å¤ç”¨æ€§ï¼š
   â”œâ”€ å…¶ä»–åœ°æ–¹å¯èƒ½ç”¨åˆ° â†’ å¿…é¡»æŠ½å–
   â”œâ”€ åªæœ‰å½“å‰åœºæ™¯ä½¿ç”¨ â†’ æ ¹æ®å¤æ‚åº¦å†³å®š
   â””â”€ ä¸å½“å‰ç±»å¼ºç»‘å®š â†’ ä¿ç•™

4. å·²æœ‰ Service åŒ¹é…åº¦ï¼š
   â”œâ”€ å®Œå…¨åŒ¹é…å·²æœ‰ service èŒè´£ â†’ æ·»åŠ åˆ°å·²æœ‰ service
   â”œâ”€ éƒ¨åˆ†åŒ¹é… â†’ è¯„ä¼°æ˜¯å¦æ‰©å±•å·²æœ‰ service
   â””â”€ ä¸åŒ¹é… â†’ åˆ›å»ºæ–° serviceï¼ˆéœ€æ…é‡ï¼‰
```

**æŠ½å–ç¤ºä¾‹åœºæ™¯**ï¼š

**âœ… åº”è¯¥æŠ½å–**ï¼š
```java
// å¤æ‚çš„è®¢å•è®¡ç®—é€»è¾‘ â†’ OrderCalculationService
public BigDecimal calculateOrderAmount(Order order) {
    BigDecimal baseAmount = order.getBasePrice();
    if (order.hasDiscount()) {
        baseAmount = applyDiscount(baseAmount, order.getDiscountRate());
    }
    if (order.hasShippingFee()) {
        baseAmount = baseAmount.add(calculateShippingFee(order));
    }
    return applyTax(baseAmount, order.getTaxRate());
}

// æ•°æ®åº“å¤æ‚æŸ¥è¯¢ â†’ UserRepository/UserDataService
public List<User> findActiveUsersWithConditions(UserQuery query) {
    // å¤æ‚çš„ SQL æ„å»ºå’Œæ‰§è¡Œé€»è¾‘
}
```

**âŒ ä¸éœ€è¦æŠ½å–**ï¼š
```java
// ç®€å•å±æ€§è®¾ç½®
public void updateUserLastLogin(User user) {
    user.setLastLoginTime(new Date());
    user.setLoginCount(user.getLoginCount() + 1);
}

// ç®€å•æ ¼å¼è½¬æ¢
public String formatUserDisplayName(User user) {
    return user.getFirstName() + " " + user.getLastName();
}
```

## é˜¶æ®µ 6: GREEN ğŸŸ¢

1. è¿è¡Œæµ‹è¯• â†’ å¿…é¡»å…¨éƒ¨é€šè¿‡
2. æ£€æŸ¥ `acceptance` æ•°ç»„æ¯é¡¹æ˜¯å¦æ»¡è¶³
3. **è¾¹ç•ŒéªŒè¯**ï¼š
   - ç¡®è®¤åªä¿®æ”¹äº†åº”è¯¥ä¿®æ”¹çš„å†…å®¹
   - ç¡®è®¤æ²¡æœ‰è¯¯æ”¹ç›¸ä¼¼ä½†ä¸ç›¸å…³çš„ä»£ç 
4. å¿«é€Ÿ self-checkï¼š
   - âœ“ è¾¹ç•Œï¼šAPI å…¼å®¹ï¼Ÿè·¨æ¨¡å—è°ƒç”¨æ­£å¸¸ï¼Ÿ
   - âœ“ å¥å£®ï¼šé”™è¯¯å¤„ç†ï¼Ÿè¾¹ç•Œæƒ…å†µï¼Ÿ
   - âœ“ ç²¾å‡†ï¼šåªæ”¹äº†è¯¥æ”¹çš„ï¼Ÿæ²¡ç¢°ä¸è¯¥ç¢°çš„ï¼Ÿ

**æ—¥å¿—**:
```
[æ—¶é—´æˆ³] [Green] Task N: å®ç°å®Œæˆ
â”œâ”€ çŠ¶æ€: green â†’ committing
â”œâ”€ å†³ç­–: å®ç°è¦ç‚¹/æƒè¡¡å–èˆ
â”œâ”€ æ–‡ä»¶: impl.ts, test.spec.tsï¼ˆå·²å®Œæˆï¼‰
â”œâ”€ Service æŠ½å–: æ–°å¢ XXXService.methodName() | ä¿ç•™åœ¨å½“å‰ç±»ï¼ˆåŸå› ï¼‰
â”œâ”€ é—®é¢˜: é‡åˆ° XXX â†’ é€šè¿‡ YYY è§£å†³ï¼ˆæˆ– noneï¼‰
â””â”€ ä¸‹ä¸€æ­¥: æ ‡è®°ä»»åŠ¡å®Œæˆï¼Œæäº¤
---
```

## é˜¶æ®µ 7: COMMIT

1. è®¾ç½® `passes: true` åœ¨ features.json
2. å†™æœ€ç»ˆæ—¥å¿—

**æ—¥å¿—**:
```
[æ—¶é—´æˆ³] [Done] Task N: âœ… å®Œæˆ
â”œâ”€ çŠ¶æ€: done
â”œâ”€ å†³ç­–: å…³é”®æ¶æ„å†³ç­–æ€»ç»“
â”œâ”€ æ–‡ä»¶: æ‰€æœ‰å˜æ›´æ–‡ä»¶åˆ—è¡¨
â”œâ”€ é—®é¢˜: ä¸»è¦é—®é¢˜åŠè§£å†³æ–¹æ¡ˆæ€»ç»“
â””â”€ ä¸‹ä¸€æ­¥: /plan-next ç»§ç»­ä¸‹ä¸€ä»»åŠ¡
---
```

## æˆåŠŸæ ‡å‡†

ä»»åŠ¡å®Œæˆå‰å¿…é¡»æ»¡è¶³ï¼š
1. âœ… æµ‹è¯•é€šè¿‡ï¼ˆRED â†’ GREENï¼‰
2. âœ… `acceptance` å…¨éƒ¨æ»¡è¶³
3. âœ… `passes: true` å·²è®¾ç½®
4. âœ… `logs/task-{id}.log` åŒ…å« 3-4 æ¡æ—¥å¿—

## æ¢å¤æŒ‡å—

**æ–°ä¼šè¯æ¢å¤æµç¨‹**ï¼š
```
1. è¯» features.json â†’ æ‰¾åˆ°å½“å‰ä»»åŠ¡
2. è¯» logs/task-{id}.log æœ€åä¸€æ¡ â†’ æŸ¥çœ‹"çŠ¶æ€"å’Œ"ä¸‹ä¸€æ­¥"
3. ä»"ä¸‹ä¸€æ­¥"ç»§ç»­æ‰§è¡Œ
```

## çŠ¶æ€å¯¹åº”è¡¨

| çŠ¶æ€ | å«ä¹‰ | ä¸‹ä¸€æ­¥ |
|------|------|--------|
| exploring | æ­£åœ¨åˆ†æ | ç»§ç»­åˆ†ææˆ–è¿›å…¥ planning |
| planning | æ­£åœ¨è§„åˆ’ | å†™æµ‹è¯•ï¼Œè¿›å…¥ red |
| red | æµ‹è¯•å·²å†™ï¼Œå¾…å®ç° | å†™å®ç°ä»£ç  |
| implementing | æ­£åœ¨å®ç° | ç»§ç»­å®ç°ï¼Œç„¶åæµ‹è¯• |
| green | æµ‹è¯•é€šè¿‡ | æ£€æŸ¥ acceptanceï¼Œæäº¤ |
| blocked | é‡åˆ°é˜»å¡ | è§£å†³é—®é¢˜åç»§ç»­ |
| done | å®Œæˆ | /plan-next |

## å®Œæˆåè¾“å‡º

```
âœ… ä»»åŠ¡ [ID] å®Œæˆï¼

ğŸ“„ æ—¥å¿—: logs/task-{id}.log
â†’ è¿è¡Œ /plan-next ç»§ç»­ä¸‹ä¸€ä»»åŠ¡
```
