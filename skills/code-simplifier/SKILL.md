---
name: code-simplifier
description: 简化和优化代码，提升清晰度、一致性和可维护性，同时保持原有功能不变。专注于最近修改的代码，除非明确要求更大范围。当用户说 "/code-simplifier"、"简化代码"、"优化代码"、"重构代码"、"清理代码" 时触发。支持 Go、Java、Python 语言。
---

# Code Simplifier

代码简化专家，专注于提升代码清晰度、一致性和可维护性，同时保持原有功能不变。

## 核心原则

### 1. 保持功能不变

- 绝不改变代码的行为
- 所有原有功能、输出和行为必须保持完整
- 只改变"怎么做"，不改变"做什么"

### 2. 提升清晰度

| 做 | 不做 |
|---|-----|
| 减少不必要的复杂度和嵌套 | 使用嵌套三元运算符 |
| 消除冗余代码和抽象 | 过度压缩代码 |
| 使用清晰的变量和函数命名 | 使用晦涩的缩写 |
| 合并相关逻辑 | 合并不相关的逻辑 |
| 删除描述显而易见内容的注释 | 删除有价值的注释 |

**重要**：选择清晰而非简短 - 显式代码通常优于过度紧凑的代码

### 3. 保持平衡

避免过度简化导致：
- 降低代码清晰度或可维护性
- 创建难以理解的"聪明"解决方案
- 将太多关注点合并到单个函数
- 删除有助于代码组织的有用抽象
- 为了"更少行数"牺牲可读性
- 使代码更难调试或扩展

### 4. 聚焦范围

- 默认只优化**当前会话中最近修改的代码**
- 除非用户明确要求更大范围

## 协议

### 步骤 1: 识别目标代码

1. 确定最近修改的代码区域
2. 如果用户指定了文件/函数，以用户指定为准
3. 列出将要分析的代码范围

### 步骤 2: 分析优化机会

检查以下方面：

| 检查项 | 示例 |
|--------|------|
| 复杂嵌套 | 多层 if-else、嵌套循环 |
| 冗余代码 | 重复逻辑、无用变量 |
| 命名问题 | 不清晰的变量名、函数名 |
| 过度抽象 | 不必要的包装类/函数 |
| 缺失抽象 | 应该提取的重复模式 |

### 步骤 3: 应用语言特定规范

根据检测到的语言应用对应规范：

| 语言 | 规范来源 |
|------|---------|
| Go | 字节跳动 Go 开发规范 |
| Java | 阿里巴巴 Java 开发规范 |
| Python | PEP 8 + Google Python Style |

### 步骤 4: 执行简化

对每处优化：

1. **展示原代码**（简短片段）
2. **展示优化后代码**
3. **说明改动理由**（一句话）

```
// 原代码
[code snippet]

// 优化后
[simplified code]

// 理由: [简短说明]
```

### 步骤 5: 验证

- 确认功能保持不变
- 确认代码更简洁、更易维护
- 列出主要改动摘要

## 语言特定指南

### Go

```go
// 避免
if err != nil {
    return err
}
if result == nil {
    return nil
}
return result

// 推荐
if err != nil {
    return err
}
return result
```

- 优先使用早返回减少嵌套
- 避免不必要的 else
- 使用表驱动而非多个 if-else
- 错误处理保持简洁

### Java

```java
// 避免
public String getName() {
    if (this.name != null) {
        return this.name;
    } else {
        return "default";
    }
}

// 推荐
public String getName() {
    return this.name != null ? this.name : "default";
}
```

- 使用 Optional 处理可空值
- 优先使用 Stream API 处理集合
- 避免过深的继承层次
- 使用 Lombok 减少样板代码

### Python

```python
# 避免
result = []
for item in items:
    if item.active:
        result.append(item.name)

# 推荐
result = [item.name for item in items if item.active]
```

- 使用列表推导式替代简单循环
- 使用 f-string 替代字符串拼接
- 使用 pathlib 替代 os.path
- 使用 dataclass 替代普通类（数据容器场景）

## 输出格式

```
## 代码简化报告

**范围**: [文件/函数列表]
**语言**: [Go/Java/Python]

### 优化项

1. **[位置]**: [简短描述]
   - 原因: [为什么需要改]
   - 改动: [具体做了什么]

### 摘要

- 优化项数: N
- 主要改进: [一句话总结]
```

⚠️ **完成后，停止并等待下一个命令。**
